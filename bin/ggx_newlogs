#!/usr/bin/env ruby
require_relative "../lib/ggx_monitor/newlogs"

begin

  case ARGV[0]

  when /^create_table/i
    NewLogs.create_table
  when /^drop_table/i
    NewLogs.drop_table
  when /^empty_table/i
    NewLogs.empty_table
  when /^help/i
    help = "\nusage: ggx_newlogs \
    [ drop_table | create_table | empty_table ]\n\n" +
    "This utility collects digital logs from a specified number of days ago\n" +
    "from GeoGraphix projects listed in settings.yml and writes them to\n"+
    "SQL Server where they can viewed via SharePoint reports.\n\n"+
    "drop_table:\tdrops the GGX_NEWLOGS table stored on SQL Server\n" +
    "create_table:\tcreates the GGX_NEWLOGS table\n\n" +
    "(YOUR ACCOUNT WILL NEED PERMISSIONS TO MSSQL AND GGX ADMIN SHARES)"
    puts help
  else
    NewLogs.process_projects
  end

rescue => e
  raise e if $DEBUG
  STDERR.puts e.message
  STDERR.puts e.backtrace.join("\n")
  exit 1
end
